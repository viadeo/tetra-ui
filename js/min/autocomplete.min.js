/*! Tetra UI v1.2.9 | (MIT Licence) (c) Viadeo/APVO Corp - inspired by Bootstrap (c) Twitter, Inc. (Apache 2 Licence) */

tetra.controller.register("autocomplete",{scope:"autocomplete",use:["suggestions"],constr:function(a,b,c,d){"use strict";return{events:{model:{suggestions:{append:function(a){b.notify("display suggestions",a[0].getAll())}}},view:{"do query":function(b){a.methods.startCountDown(function(a){d("suggestions").select({param:a.param,uriParams:{url:a.url},id:a.id})},b)},"select suggestion":function(a){var e=a.ref.split(":")[0],f=a.ref.split(":")[1];d("suggestions").findByRef(e,function(b){c.notify("autocomplete: item selected",{obj:b.get("suggestions").data[f],origin:a.id})}),b.notify("display value",a)}}},methods:{init:function(){a.defaultTypingDelay=150,a.countDown=null},startCountDown:function(b,c){a.countDown&&window.clearTimeout(a.countDown);var d="undefined"!=typeof c.typingDelay?c.typingDelay:a.defaultTypingDelay;a.countDown=window.setTimeout(function(){b(c)},d)}}}}}),tetra.view.register("autocomplete",{scope:"autocomplete",use:["autocomplete"],constr:function(a,b,c){"use strict";return{events:{user:{keydown:{".autocomplete input":function(a,c){var d=c.parents(".autocomplete");switch(a.which){case 13:a.preventDefault();var e=d.find(".autocomplete-menu li.active");b.notify("select suggestion",{value:e.attr("data-value"),id:d.attr("id"),ref:e.attr("data-ref")});break;case 38:case 40:a.preventDefault()}}},keyup:{".autocomplete input":function(c,d){var e=d.parents(".autocomplete");switch(c.which){case 37:case 39:e.hasClass("active")||b.notify("do query",{url:e.attr("data-url"),param:d.val(),id:e.attr("id")});break;case 13:break;case 27:a.methods.suggestions.hide(e.attr("id"));break;case 38:a.methods.suggestions.select(e.attr("id"),"previous");break;case 40:a.methods.suggestions.select(e.attr("id"),"next");break;default:d.val().length>=parseInt(e.attr("data-min-length"),10)&&b.notify("do query",{url:e.attr("data-url"),param:d.val(),id:e.attr("id"),typingDelay:e.attr("data-typing-delay")||void 0})}}},blur:{".autocomplete input":function(b,c){var d=c.parents(".autocomplete");window.setTimeout(function(){a.methods.suggestions.hide(d.attr("id"))},200)}},click:{".autocomplete .autocomplete-menu li":function(a,c){var d=c.parents(".autocomplete");b.notify("select suggestion",{value:c.attr("data-value"),id:d.attr("id"),ref:c.attr("data-ref")})}}},controller:{"display suggestions":function(a){var d=c("#"+a.suggestions.id),e=d.find(".autocomplete-menu");c.each(a.suggestions.data,function(b,c){c.ref=a.ref+":"+b}),b.exec(d.attr("data-template-id"),a.suggestions,function(a){c(e).html(a)}),d.attr("data-no-default")||e.find("li:first-child").addClass("active"),d.addClass("active")},"display value":function(b){var d=c("#"+b.id);d.find("input").val(b.value),a.methods.suggestions.hide(b.id)}}},methods:{suggestions:{select:function(a,b){var d=c("#"+a).find(".autocomplete-menu li"),e=d.filter(".active").removeClass("active").index();e+="next"===b?1:-1,e>=d.length?e=0:-1>e&&(e=d.length-1),d.eq(e).addClass("active")},hide:function(a){c("#"+a).removeClass("active")}}}}}});