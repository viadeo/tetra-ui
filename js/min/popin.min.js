/*! Tetra UI v1.2.9 | (MIT Licence) (c) Viadeo/APVO Corp - inspired by Bootstrap (c) Twitter, Inc. (Apache 2 Licence) */

tetra.model.register("popin",{scope:"popin",req:{fetch:{url:"{0}",uriParams:["url"],parser:function(a,b,c){return b[c.uriParams.url]={id:c.uriParams.url,html:a.toString(),timestamp:c.timestamp},b}}},attr:{html:"",url:"",timestamp:""},methods:function(a){return{validate:function(a,b){return b},getAttr:function(){return a}}}}),tetra.controller.register("popin",{scope:"popin",use:["popin"],constr:function(a,b,c,d){"use strict";return{events:{model:{popin:{fetch:function(){b.notify("start loading")},append:function(a){var d={html:a[0].get("html"),url:a[0].get("id"),_timestamp:a[0].get("timestamp")};b.notify("end loading").notify("set content",{content:d.html}),c.notify("popin: success",d)},error:function(a){b.notify("end loading").notify("show error",a)}}},view:{"popin: set content":function(b){a.methods.setContent(b)},"popin: close":function(){b.notify("clear",{url:a.url,id:a.id})},"popin: closed":function(a){c.notify("popin: closed",a)}},controller:{"popin: loading":function(){b.notify("start loading")},"popin: set content":function(b){a.methods.setContent(b)},"popin: close":function(){b.notify("clear",{url:a.url,id:a.id})},"popin: fadeout":function(){b.notify("fadeout",{url:a.url,id:a.id}),window.setTimeout(function(){b.notify("clear",{url:a.url,id:a.id})},300)},"popin: show loader":function(){b.notify("show loader")},"popin: hide loader":function(){b.notify("hide loader")}}},methods:{init:function(){a.id=null,a.url=null},setContent:function(e){e._timestamp=(new Date).getTime(),e.url?(a.url=e.url,a.id=null,d("popin").fetch({uriParams:{url:e.url},timestamp:e._timestamp})):e.id?(a.id=e.id,a.url=null,b.notify("start loading").notify("load from dom",e.id),c.notify("popin: success",e)):e.html&&(a.id=null,a.url=null,b.notify("start loading").notify("set content",{content:e.html}),c.notify("popin: success",e))}}}}}),tetra.view.register("popin",{scope:"popin",use:["popin"],constr:function(a,b,c){"use strict";return{events:{user:{click:{"[data-popin]":function(a,c){"show"===c.attr("data-popin")?c.attr("data-target-url")?b.notify("popin: set content",{url:c.attr("data-target-url")}):c.attr("data-target-id")&&b.notify("popin: set content",{id:c.attr("data-target-id")}):"close"===c.attr("data-popin")&&b.notify("popin: close")}}},window:{keyup:function(a){27!==a.keyCode||c(".popin-container .popin").attr("data-noesc")||b.notify("popin: close")}},controller:{"start loading":function(){a.methods.clear(),a.methods.createPopin()},"end loading":function(){},"set content":function(b){a.methods.createPopin(),c("body .popin-container").html(b.content)},"show error":function(b){a.methods.clear(),401!==b.errorCode&&VNS.ui.growl(lang["notification.modification.save.error"],{type:"warn"})},clear:function(d){if(d.id){var e=c(".popin-container").html();a.methods.clear(),c("#"+d.id).html(e)}else a.methods.clear();b.notify("popin: closed",d)},fadeout:function(){c(".popin-overlay").remove(),c(".popin-container .popin").addClass("popin-close-animation")},"load from dom":function(a){var b=c("#"+a).html();c("#"+a).empty(),c(".popin-container").html(b)},"show loader":function(){c(".popin-container .popin-footer").addClass("loading")},"hide loader":function(){c(".popin-container .popin-footer").removeClass("loading")}}},methods:{init:function(){},clear:function(){c(".popin-container").remove(),c(".popin-overlay").remove()},createPopin:function(){c(".popin-overlay").length||c("body").append('<div class="popin-overlay"></div><div class="popin-container"><span class="popin-loader"></span></div>')}}}}});